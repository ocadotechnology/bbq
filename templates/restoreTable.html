{% extends "bbq-menu.html" %}
{% block main %}

    <h2>Restore table</h2>
    <script type="text/javascript">
        function OnSubmitForm() {
            let params = {
                'targetProjectId': document.restoreTableForm.targetProjectId.value,
                'targetDatasetId': document.restoreTableForm.targetDatasetId.value,
                'createDisposition': document.restoreTableForm.createDisposition.value,
                'writeDisposition': document.restoreTableForm.writeDisposition.value,
                'restorationDate': document.restoreTableForm.restorationDate.value,
                'partitionId': document.restoreTableForm.partitionId.value
            };
            let url = '/restore' +
                '/project/' + document.restoreTableForm.projectId.value +
                '/dataset/' + document.restoreTableForm.datasetId.value +
                '/table/' + document.restoreTableForm.tableId.value + "?"
                + encodeQueryData(params);
            let xhttp = new XMLHttpRequest();

            xhttp.open("GET", url, true);
            xhttp.timeout = 1000 * 3600;
            xhttp.onload = function () {
                document.getElementById("response").innerHTML = JSON.stringify(JSON.parse(xhttp.responseText),
                    undefined, 2);
                makeUrlsClickable();
            };
            xhttp.ontimeout = function (e) {
                document.getElementById("response").innerHTML = "Request timeout: " + e;
            };

            console.log(url);
            xhttp.send();

            return false;
        }
    </script>

    <p class="lead">
        This form restores single non-partitioned table or single partition. In
        case of restoring multiple partitions from partitioned table, you need
        to submit this form for every partition which you want to restore.
    </p>

    <form name="restoreTableForm" onsubmit="return OnSubmitForm();">
        <div class="form-group row">
            <div class="col">
                <h4>Source table information</h4>
            </div>
        </div>
        <div class="form-group row">
            <label for="sourceProjectId" class="col-sm-2 col-form-label">
                Source project id
            </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="sourceProjectId"
                       name="projectId" placeholder="project id" required/>
            </div>
        </div>
        <div class="form-group row">
            <label for="sourceDatasetId" class="col-sm-2 col-form-label">
                Source dataset id
            </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="sourceDatasetId"
                       name="datasetId" placeholder="dataset id">
            </div>
        </div>
        <div class="form-group row">
            <label for="sourceTableId" class="col-sm-2 col-form-label">
                Source table id
            </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="sourceTableId"
                       name="tableId" placeholder="table id">
            </div>
        </div>
        <div class="form-group row">
            <label for="sourcePartitionId" class="col-sm-2 col-form-label">
                Source partition id
            </label>
            <div class="col-sm-8">
                <input type="number" class="form-control" id="sourcePartitionId"
                       name="partitionId" placeholder="partition id">
                <small id="sourcePartitionIdHelp" class="form-text text-muted">
                    Valid and required for partitioned tables only. Partition
                    id of original table. If specified, only this single
                    partition will be restored
                </small>
            </div>
        </div>
        <div class="form-group row">
            <div class="col">
                <h4>Target table information</h4>
            </div>
        </div>
        <div class="form-group row">
            <label for="targetProjectId" class="col-sm-2 col-form-label">
                Restore to source
            </label>
            <label class="radio-inline col-sm-1 col-form-label"
                   id="restoreToSource">
                <input type="radio" name="optradio"
                       onclick="restoreToSource()"> Yes
            </label>
            <label class="radio-inline col-form-label"
                   id="restoreNotToSource">
                <input type="radio" name="optradio" checked
                       onclick="restoreNotToSource()"> No
            </label>
        </div>
        <div class="form-group row">
            <label for="targetProjectId" class="col-sm-2 col-form-label">
                Target project id
            </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="targetProjectId"
                       name="targetProjectId" placeholder="source_project_id"
                       value="{{ default_restoration_project_id }}">
                <small id="targetProjectIdHelp" class="form-text text-muted">
                    <b>Optional</b>. Target project id. If not passed,
                    source project id will be used.
                </small>
            </div>
        </div>
        <div class="form-group row">
            <label for="targetDatasetId" class="col-sm-2 col-form-label">
                Target dataset id
            </label>
            <div class="input-group col-sm-8">
                <input type="text" class="form-control" id="targetDatasetId"
                       name="targetDatasetId" placeholder="source_dataset_id">
                <small id="targetDatasetIdHelp" class="form-text text-muted">
                    <b>Optional</b>. Temporary dataset id that will be used
                    (and created if does not exist) as container for
                    restored table. Note that passed dataset could already
                    exists - it should be in the same location as backup.
                    If target dataset id is not passed, then source dataset id
                    value will be used as a target dataset id in restoration
                    project.
                </small>
            </div>
        </div>
        <div class="form-group row">
            <div class="col">
                <h4>Options</h4>
            </div>
        </div>
        <div class="form-group row">
            <label for="createDisposition" class="col-sm-2 col-form-label">
                Create disposition
            </label>
            <div class="col-sm-8">
                <select class="form-control" id="createDisposition"
                        name="createDisposition">
                    <option>CREATE_IF_NEEDED</option>
                    <option>CREATE_NEVER</option>
                </select>
                <small id="createDispositionHelp" class="form-text text-muted">
                    Specifies whether the job is allowed to create new
                    tables.<br>

                    The following values are supported:<br>
                    <b>CREATE_IF_NEEDED</b>: If the table does not exist,
                    BigQuery creates the table.<br>
                    <b>CREATE_NEVER</b>: The table must already exist. If it
                    does not, a 'notFound' error is
                    returned in the job result.<br>
                    The default value is <b>CREATE_IF_NEEDED</b>.
                </small>
            </div>
        </div>
        <div class="form-group row">
            <label for="writeDisposition" class="col-sm-2 col-form-label">
                Write disposition
            </label>
            <div class="col-sm-8">
                <select class="form-control" id="writeDisposition"
                        name="writeDisposition">
                    <option>WRITE_EMPTY</option>
                    <option>WRITE_TRUNCATE</option>
                    <option>WRITE_APPEND</option>
                </select>
                <small id="writeDispositionHelp" class="form-text text-muted">
                    Specifies the action that occurs if the destination table
                    already exists.<br>

                    The following values are supported:<br>
                    <b>WRITE_EMPTY</b>: If the table already exists and contains
                    data, a 'duplicate' error is
                    returned in the job result.<br>
                    <b>WRITE_TRUNCATE</b>: If the table already exists, BigQuery
                    overwrites the table data.<br>
                    <b>WRITE_APPEND</b>: If the table already exists, BigQuery
                    appends the data to the
                    table.<br>
                    The default value is <b>WRITE_EMPTY</b>.
                </small>
            </div>
        </div>
        <div class="form-group row">
            <label for="restorationDate" class="col-sm-2 col-form-label">
                Restoration date
            </label>
            <div class="col-sm-4">
                <input type="date" class="form-control" id="restorationDate"
                       name="restorationDate">
                <small id="restorationDateHelp" class="form-text text-muted">
                    <b>Optional.</b> BBQ will restore the
                    most recent version of backup on given date. Default value
                    is today
                </small>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-sm-4">
                <button type="submit" class="btn btn-primary">
                    Restore table
                </button>
            </div>
        </div>
    </form>

    <br><strong>Response:</strong> <br>
    <pre id="response"></pre>

{% endblock %}